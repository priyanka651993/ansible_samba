---
 - name:  single user samba
   hosts:  samba
   gather_facts:  no
   tasks:
     - name:  install samba
       yum:  
         name:  samba
         state:  present
    
     - name:  install samba-client
       yum:
         name:  samba-client
         state:  present
    

     - name:  start smb service
       service:
        name:   smb
        state:  started
        enabled:  yes

     - name:  start nmb service
       service:
        name:  nmb
        state:  started
        enabled:  yes

     - name:  add user john
       user:
        name:  john
        shell:  /bin/bash
        groups:  root
        append:  yes

     - name:  assign samba password to john
       command: echo "123" | smbpasswd -a --stdin linuxuser  
        
     - name:  create directory /data
       file:
        path: /data
        state:  touch
        owner:  root
        group:  root
        mode:  '0757' 
  
     - name:  change selinux context of /data
       sefcontext:
        target:  /data
        setype:  samba_share_t
        state:  present  
     
     - name:  set selinux context
       command:  restorecon -vvRF /data

     - name:  add samba share to /etc/samba/smb.conf
       lineinfile:
        line:  "[smbshare]\n
                path=/data\n
                valid users=john\n
                browseable=yes\n
                hosts allow= 172.25.1."     
        path:  /etc/samba/smb.conf

     
